
(function(root,factory){if(typeof exports!=='undefined'){module.exports=factory(require("jquery"),require("underscore"),require("backbone"));}else if(typeof define==='function'&&define.amd){define(["jquery","underscore","backbone"],factory);}else{factory(root.$,root._,root.Backbone);}}(this,function($,_,Backbone){'use strict';var _delayedTriggers=[],nestedChanges;Backbone.NestedModel=Backbone.Model.extend({get:function(attrStrOrPath){return Backbone.NestedModel.walkThenGet(this.attributes,attrStrOrPath);},previous:function(attrStrOrPath){return Backbone.NestedModel.walkThenGet(this._previousAttributes,attrStrOrPath);},has:function(attr){var result=this.get(attr);return!(result===null||_.isUndefined(result));},set:function(key,value,opts){var newAttrs=Backbone.NestedModel.deepClone(this.attributes),attrPath,unsetObj,validated;if(_.isString(key)){attrPath=Backbone.NestedModel.attrPath(key);}else if(_.isArray(key)){attrPath=key;}
if(attrPath){opts=opts||{};this._setAttr(newAttrs,attrPath,value,opts);}else{opts=value||{};var attrs=key;for(var _attrStr in attrs){if(attrs.hasOwnProperty(_attrStr)){this._setAttr(newAttrs,Backbone.NestedModel.attrPath(_attrStr),opts.unset?void 0:attrs[_attrStr],opts);}}}
nestedChanges=Backbone.NestedModel.__super__.changedAttributes.call(this);if(opts.unset&&attrPath&&attrPath.length===1){unsetObj={};unsetObj[key]=void 0;nestedChanges=_.omit(nestedChanges,_.keys(unsetObj));validated=Backbone.NestedModel.__super__.set.call(this,unsetObj,opts);}else{unsetObj=newAttrs;if(opts.unset&&attrPath){opts=_.extend({},opts);delete opts.unset;}else if(opts.unset&&_.isObject(key)){unsetObj=key;}
nestedChanges=_.omit(nestedChanges,_.keys(unsetObj));validated=Backbone.NestedModel.__super__.set.call(this,unsetObj,opts);}
if(!validated){this.changed={};nestedChanges={};return false;}
this._runDelayedTriggers();return this;},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}));},clear:function(options){nestedChanges={};options=options||{};var attrs=_.clone(this.attributes);if(!options.silent&&this.validate&&!this.validate(attrs,options)){return false;}
var changed=this.changed={};var model=this;var setChanged=function(obj,prefix,options){_.each(obj,function(val,attr){var changedPath=prefix;if(_.isArray(obj)){changedPath+='['+attr+']';}else if(prefix){changedPath+='.'+attr;}else{changedPath=attr;}
val=obj[attr];if(_.isObject(val)){setChanged(val,changedPath,options);}
if(!options.silent)model._delayedChange(changedPath,null,options);changed[changedPath]=null;});};setChanged(this.attributes,'',options);this.attributes={};if(!options.silent)this._delayedTrigger('change');this._runDelayedTriggers();return this;},add:function(attrStr,value,opts){var current=this.get(attrStr);if(!_.isArray(current))throw new Error('current value is not an array');return this.set(attrStr+'['+current.length+']',value,opts);},remove:function(attrStr,opts){opts=opts||{};var attrPath=Backbone.NestedModel.attrPath(attrStr),aryPath=_.initial(attrPath),val=this.get(aryPath),i=_.last(attrPath);if(!_.isArray(val)){throw new Error("remove() must be called on a nested array");}
var trigger=!opts.silent&&(val.length>=i+1),oldEl=val[i];val.splice(i,1);opts.silent=true;this.set(aryPath,val,opts);if(trigger){attrStr=Backbone.NestedModel.createAttrStr(aryPath);this.trigger('remove:'+attrStr,this,oldEl);for(var aryCount=aryPath.length;aryCount>=1;aryCount--){attrStr=Backbone.NestedModel.createAttrStr(_.first(aryPath,aryCount));this.trigger('change:'+attrStr,this,oldEl);}
this.trigger('change',this,oldEl);}
return this;},changedAttributes:function(diff){var backboneChanged=Backbone.NestedModel.__super__.changedAttributes.call(this,diff);if(_.isObject(backboneChanged)){return _.extend({},nestedChanges,backboneChanged);}
return false;},toJSON:function(){return Backbone.NestedModel.deepClone(this.attributes);},_delayedTrigger:function(){_delayedTriggers.push(arguments);},_delayedChange:function(attrStr,newVal,options){this._delayedTrigger('change:'+attrStr,this,newVal,options);if(!this.changed){this.changed={};}
this.changed[attrStr]=newVal;},_runDelayedTriggers:function(){while(_delayedTriggers.length>0){this.trigger.apply(this,_delayedTriggers.shift());}},_setAttr:function(newAttrs,attrPath,newValue,opts){opts=opts||{};var fullPathLength=attrPath.length;var model=this;Backbone.NestedModel.walkPath(newAttrs,attrPath,function(val,path,next){var attr=_.last(path);var attrStr=Backbone.NestedModel.createAttrStr(path);var isNewValue=!_.isEqual(val[attr],newValue);if(path.length===fullPathLength){if(opts.unset){delete val[attr];if(_.isArray(val)){var parentPath=Backbone.NestedModel.createAttrStr(_.initial(attrPath));model._delayedTrigger('remove:'+parentPath,model,val[attr]);}}else{val[attr]=newValue;}
if(!opts.silent&&_.isObject(newValue)&&isNewValue){var visited=[];var checkChanges=function(obj,prefix){if(_.indexOf(visited,obj)>-1){return;}else{visited.push(obj);}
var nestedAttr,nestedVal;for(var a in obj){if(obj.hasOwnProperty(a)){nestedAttr=prefix+'.'+a;nestedVal=obj[a];if(!_.isEqual(model.get(nestedAttr),nestedVal)){model._delayedChange(nestedAttr,nestedVal,opts);}
if(_.isObject(nestedVal)){checkChanges(nestedVal,nestedAttr);}}}};checkChanges(newValue,attrStr);}}else if(!val[attr]){if(_.isNumber(next)){val[attr]=[];}else{val[attr]={};}}
if(!opts.silent){if(path.length>1&&isNewValue){model._delayedChange(attrStr,val[attr],opts);}
if(_.isArray(val[attr])){model._delayedTrigger('add:'+attrStr,model,val[attr]);}}});}},{attrPath:function(attrStrOrPath){var path;if(_.isString(attrStrOrPath)){path=(attrStrOrPath==='')?['']:attrStrOrPath.match(/[^\.\[\]]+/g);path=_.map(path,function(val){return val.match(/^\d+$/)?parseInt(val,10):val;});}else{path=attrStrOrPath;}
return path;},createAttrStr:function(attrPath){var attrStr=attrPath[0];_.each(_.rest(attrPath),function(attr){attrStr+=_.isNumber(attr)?('['+attr+']'):('.'+attr);});return attrStr;},deepClone:function(obj){return $.extend(true,{},obj);},walkPath:function(obj,attrPath,callback,scope){var val=obj,childAttr;for(var i=0;i<attrPath.length;i++){callback.call(scope||this,val,attrPath.slice(0,i+1),attrPath[i+1]);childAttr=attrPath[i];val=val[childAttr];if(!val)break;}},walkThenGet:function(attributes,attrStrOrPath){var attrPath=Backbone.NestedModel.attrPath(attrStrOrPath),result;Backbone.NestedModel.walkPath(attributes,attrPath,function(val,path){var attr=_.last(path);if(path.length===attrPath.length){result=val[attr];}});return result;}});return Backbone;}));if(!window.console)window.console={};if(!window.console.log)window.console.log=function(){};var qc=qc||{};var focused=window;qc.event=_.extend({},Backbone.Events);qc.statistic=qc.statistic||{};$.fn.serializeObject=function(){var o={};var a=this.serializeArray();$.each(a,function(){if(o[this.name]!==undefined){if(!o[this.name].push){o[this.name]=[o[this.name]];}
o[this.name].push(this.value||'');}else{o[this.name]=this.value||'';}});return o;};function preloaderStart(){$('.preloader').delay(500).fadeIn(300);}
function preloaderStop(){$('.preloader').stop(true,true).fadeOut(300);}
function sformat(pattern,address){var result=pattern;result=result.replace(/\{firstname\}/g,'<strong>'+address.firstname);result=result.replace(/\{lastname\}/g,address.lastname+'</strong>');result=result.replace(/\{company\}/g,address.company);result=result.replace(/\{address_1\}/g,address.address_1);result=result.replace(/\{address_2\}/g,address.address_2);result=result.replace(/\{city\}/g,address.city);result=result.replace(/\{zone\}/g,address.zone);result=result.replace(/\{country\}/g,address.country);result=result.replace(/\{postcode\}/g,address.postcode);result=result.replace(/\{zone_code\}/g,address.zone_code);result=result.replace(/^\s*\n/gm,"");result=result.replace(/^\s+|\s+$/g,"");return result;}qc.Model=Backbone.NestedModel.extend({defaults:'',initialize:function(){console.log("Engine Model start");},isJson:function(str){try{JSON.parse(str);}catch(e){return false;}
return true;},updateForm:function(data){preloaderStop();if(parseInt(config.general.debug)){console.log(data);}
qc.event.trigger('update',data);if(data.redirect){window.location=data.redirect;}
if(data.account){qc.event.trigger('changeAccount',data.account);}
if(data.login_error){qc.login.set('error',data.login_error);}
if(data.error){alert(data.error);}},});qc.View=Backbone.View.extend({defaults:'',initialize:function(){console.log("Engine View start");},events:{'focus input':"updateFocus"},changeAccount:function(account){if(this.model.get('account')!==account){this.model.changeAccount(account);this.render();}},isJson:function(str){try{JSON.parse(str);}catch(e){return false;}
return true;},});qc.Login=qc.Model.extend({defaults:'',initialize:function(){this.set('config',config.account[this.get('account')].login);},changeAccount:function(account){this.set('account',account);},loginAccount:function(json){this.set(json);var that=this;$.post('index.php?route=d_quickcheckout/login/loginAccount',json,function(data){if(parseInt(config.general.login_refresh)){window.location.reload();}else{that.updateForm(data);}},'json').error();},updateAccount:function(account){this.set('account',account);this.set('config',config.account[this.get('account')].login);var json=this.toJSON();var that=this;$.post('index.php?route=d_quickcheckout/login/updateAccount',{'account':json.account},function(data){that.updateForm(data);},'json').error();},});qc.LoginView=qc.View.extend({initialize:function(e){Backbone.View.prototype.initialize.call(this);this.template=e.template;qc.event.bind("changeAccount",this.changeAccount,this);this.model.on("change",this.render,this);this.render();},events:{'change input[name=account]':'updateAccount','click button#button_login':'loginAccount',},template:'',render:function(){$(this.el).html(this.template({'model':this.model.toJSON()}));$('body').on('click',function(){$('#login_button_popup').removeClass('active');})},changeAccount:function(account){if(this.model.get('account')!==account){this.model.changeAccount(account);this.render();}},updateAccount:function(e){this.model.updateAccount(e.currentTarget.value);if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'click',e.currentTarget.name);}
preloaderStart();},loginAccount:function(e){$('#login_model').modal('hide');$('body').removeClass('modal-open');$('.modal-backdrop').remove();var json=$('#login_form').serializeObject();this.model.loginAccount(json);if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'click','login');}
preloaderStart();return false;},});qc.FieldView=qc.View.extend({initialize:function(e){this.template=e.template;},events:{'change input[type=text].not-required':'updateField','change input[type=text].required':'validateField','change input[type=email].not-required':'updateField','change input[type=email].required':'validateField','change input[type=password].not-required':'updateField','change input[type=password].required':'validateField','change input[type=datetime].not-required':'updateField','change input[type=datetime].required':'validateField','change input[type=date].not-required':'updateField','change input[type=date].required':'validateField','change input[type=time].not-required':'updateField','change input[type=time].required':'validateField','change input[type=radio].not-required':'updateField','change input[type=radio].required':'validateField','change input[type=checkbox].not-required':'updateCheckbox','change input[type=checkbox].required':'validateCheckbox','change textarea':'validateField','change select':'validateField',},template:'',render:function(){this.setValidate();$(this.el).html(this.template({'model':this.model.toJSON()}));this.setDateTime();$('.sort-item').tsort({attr:'data-sort'});$('.qc-mask').each(function(){$(this).mask($(this).attr('qc-mask'));})},setDateTime:function(){var that=this;$('.date',this.el).datetimepicker({pickTime:false,})
$('.time',this.el).datetimepicker({pickDate:false,})
$('.datetime',this.el).datetimepicker({pickDate:true,pickTime:true,})},setValidate:function(){$(this.el).validate({submitHandler:function(form){},errorPlacement:function(error,element){error.appendTo(element.closest('div[class^="col-"]'));},highlight:function(element,errorClass,validClass){$(element.form).find("#"+element.id+"_input").addClass("has-error");},unhighlight:function(element,errorClass,validClass){$(element.form).find("#"+element.id+"_input").removeClass("has-error");},errorClass:"text-danger",errorElement:"div"});},validateField:function(e){if($(e.currentTarget).valid()){this.updateField(e);}else{if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'error',e.currentTarget.name+'.'+e.currentTarget.value);}
preloaderStop();}},updateField:function(e){this.model.updateField(e.currentTarget.name,e.currentTarget.value);if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update',e.currentTarget.name);}
preloaderStart();},validateCheckbox:function(e){if($(e.currentTarget).valid()){this.updateCheckbox(e);}else{if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'error',e.currentTarget.name+'.'+e.currentTarget.value);}
preloaderStop();}},updateCheckbox:function(e){if($(e.currentTarget).is(":checked")){this.model.updateField(e.currentTarget.name,1);}else{this.model.updateField(e.currentTarget.name,0);}
if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update',e.currentTarget.name);}
preloaderStart();},});qc.PaymentAddress=qc.Model.extend({defaults:{'payment_address':'','config':'','account':'','addresses':'',},initialize:function(){this.set('config',config.account[this.get('account')].payment_address);},changeAccount:function(account){this.set('account',account);this.set('config',config.account[this.get('account')].payment_address);},changeAddress:function(address_id){this.set('payment_address.address_id',address_id);if(address_id!='new'){this.set('payment_address.shipping_address',0);}
var json=this.toJSON();var that=this;$.post('index.php?route=d_quickcheckout/payment_address/update',{'payment_address':json.payment_address},function(data){that.updateForm(data);},'json').error();},updateField:function(name,value){this.set(name,value);var that=this;var json=this.toJSON();$.post('index.php?route=d_quickcheckout/payment_address/update',{'payment_address':json.payment_address},function(data){that.updateForm(data);},'json').error();},});qc.PaymentAddressView=qc.View.extend({initialize:function(e){this.template=e.template;qc.event.bind("update",this.update,this);this.render();},events:{'change input[type=radio].payment-address':'changeAddress','change select.country_id':'changeCountry',},template:'',fields:'',changeAccount:function(account){if(this.model.get('account')!==account){this.model.changeAccount(account);this.render();}},changeAddress:function(e){this.model.changeAddress(e.currentTarget.value);this.render();if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update','payment_address.changeAddress');}
preloaderStart();},changeCountry:function(e){this.model.set('shipping_address.zone_id',0);this.setZone(e.currentTarget.value);if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update','payment_address.changeCountry');}
preloaderStart();},setZone:function(country_id){var that=this;$.post('index.php?route=d_quickcheckout/field/getZone',{country_id:country_id},function(data){that.model.set('config.fields.zone_id.options',data);that.render();},'json');},update:function(data){if(data.payment_address){this.model.set('payment_address',data.payment_address);}
if(typeof(data.shipping_required)!=='undefined'){this.model.set('shipping_required',data.shipping_required);this.render();}
if(data.addresses){this.model.set('addresses',data.addresses);this.render();}
if(data.account&&data.account!==this.model.get('account')){this.changeAccount(data.account);this.setZone(this.model.get('payment_address.country_id'));}
if(data.payment_address_refresh){this.render();}},shipping_required:function(){if(this.model.get('shipping_required')){$('#payment_address_shipping_address_input').show();}else{$('#payment_address_shipping_address_input').hide();}},render:function(){$(this.el).html(this.template({'model':this.model.toJSON()}));this.fields=$.extend(true,{},new qc.FieldView({el:$("#payment_address_form"),model:this.model,template:_.template($("#field_template").html())}));this.fields.render();this.shipping_required();},});qc.ShippingAddress=qc.Model.extend({defaults:{'shipping_address':'','config':'','account':'','addresses':'','show_shipping_address':'',},initialize:function(){this.set('config',config.account[this.get('account')].shipping_address);},changeAccount:function(account){this.set('account',account);this.set('config',config.account[this.get('account')].shipping_address);},changeAddress:function(address_id){this.set('shipping_address.address_id',address_id);var json=this.toJSON();var that=this;$.post('index.php?route=d_quickcheckout/shipping_address/update',{'shipping_address':json.shipping_address},function(data){that.updateForm(data);},'json').error();},updateField:function(name,value){this.set(name,value);var json=this.toJSON();var that=this;$.post('index.php?route=d_quickcheckout/shipping_address/update',{'shipping_address':json.shipping_address},function(data){that.updateForm(data);},'json').error();},});qc.ShippingAddressView=qc.View.extend({initialize:function(e){this.template=e.template;qc.event.bind("update",this.update,this);this.render();},events:{'change input[type=radio].shipping-address':'changeAddress','change select.country_id':'changeCountry',},template:'',fields:'',changeAccount:function(account){if(this.model.get('account')!==account){this.model.changeAccount(account);this.render();}},changeAddress:function(e){this.model.changeAddress(e.currentTarget.value);this.render();if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update','shipping_address.changeAddress');}
preloaderStart();},changeCountry:function(e){this.model.set('shipping_address.zone_id',0);this.setZone(e.currentTarget.value);if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update','shipping_address.changeCountry');}
preloaderStart();},setZone:function(country_id){var that=this;$.post('index.php?route=d_quickcheckout/field/getZone',{country_id:country_id},function(data){that.model.set('config.fields.zone_id.options',data);that.render();},'json');},update:function(data){if(data.shipping_address){this.model.set('shipping_address',data.shipping_address);}
if(typeof(data.show_shipping_address)!=='undefined'&&data.show_shipping_address!==this.model.get('show_shipping_address')){this.model.set('show_shipping_address',data.show_shipping_address);this.render();}
if(data.addresses){this.model.set('addresses',data.addresses);this.render();}
if(typeof(data.account)!=='undefined'&&data.account!==this.model.get('account')){this.changeAccount(data.account);this.setZone(this.model.get('shipping_address.country_id'));}
if(data.shipping_address_refresh){this.render();}},render:function(){$(this.el).html(this.template({'model':this.model.toJSON()}));this.fields=$.extend(true,{},new qc.FieldView({el:$("#shipping_address_form"),model:this.model,template:_.template($("#field_template").html())}));this.fields.render();},});qc.ShippingMethod=qc.Model.extend({defaults:'',initialize:function(){this.set('config',config.account[this.get('account')].shipping_method);},changeAccount:function(account){this.set('account',account);this.set('config',config.account[this.get('account')].shipping_method);},update:function(json){var that=this;$.post('index.php?route=d_quickcheckout/shipping_method/update',json,function(data){that.updateForm(data);},'json').error();},});qc.ShippingMethodView=qc.View.extend({initialize:function(e){this.template=e.template;qc.event.bind("update",this.update,this);this.model.on("change",this.render,this);this.render();},events:{'change input[type=radio]':'updateShippingMethod','change select':'updateShippingMethod',},template:'',updateShippingMethod:function(e){this.model.update($('#shipping_method_form').serializeArray());if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update','shipping_method.'+e.currentTarget.value);}
preloaderStart();},render:function(){$(this.el).html(this.template({'model':this.model.toJSON()}));},update:function(data){if(data.shipping_method){this.model.set('shipping_method',data.shipping_method);}
if(typeof(data.show_shipping_method)!=='undefined'){this.model.set('show_shipping_method',data.show_shipping_method);}
if(data.shipping_methods){this.model.set('shipping_methods',data.shipping_methods);}
if(data.account&&data.account!==this.model.get('account')){this.changeAccount(data.account);}
if(data.shipping_method_error){this.model.set('error',data.shipping_method_error);}},});qc.PaymentMethod=qc.Model.extend({defaults:'',initialize:function(){this.set('config',config.account[this.get('account')].payment_method);},changeAccount:function(account){this.set('account',account);this.set('config',config.account[this.get('account')].payment_method);},update:function(json){var that=this;$.post('index.php?route=d_quickcheckout/payment_method/update',json,function(data){that.updateForm(data);},'json').error();},});qc.PaymentMethodView=qc.View.extend({initialize:function(e){this.template=e.template;qc.event.bind("update",this.update,this);this.model.on("change",this.render,this);this.render();},events:{'change input[type=radio]':'updatePaymentMethod','change select':'updatePaymentMethod',},template:'',updatePaymentMethod:function(e){this.model.update($('#payment_method_form').serializeArray());if(this.model.get('config.input_style')=='radio'){$('.payment-method-terms').hide();$('.payment-method-terms.'+e.currentTarget.value).show();}
if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update','payment_method.'+e.currentTarget.value);}
preloaderStart();},update:function(data){if(data.payment_method){this.model.set('payment_method',data.payment_method);}
if(data.payment_methods){this.model.set('payment_methods',data.payment_methods);}
if(data.account&&data.account!==this.model.get('account')){this.changeAccount(data.account);}},render:function(){$(this.el).html(this.template({'model':this.model.toJSON()}));$('img').error(function(){$(this).hide();});},});qc.Cart=qc.Model.extend({defaults:'',initialize:function(){this.set('config',config.account[this.get('account')].cart);},changeAccount:function(account){this.set('account',account);this.set('config',config.account[this.get('account')].cart);},updateQuantity:function(name,value){this.set(name,value);var that=this;$.post('index.php?route=d_quickcheckout/cart/update',this.toJSON(),function(data){that.updateForm(data);},'json').error();},updateVoucher:function(voucher){this.set('voucher',voucher);var that=this;$.post('index.php?route=d_quickcheckout/cart/updateVoucher',this.toJSON(),function(data){that.updateForm(data);},'json').error();},updateCoupon:function(coupon){this.set('coupon',coupon);var that=this;$.post('index.php?route=d_quickcheckout/cart/updateCoupon',this.toJSON(),function(data){that.updateForm(data);},'json').error();},updateReward:function(reward){this.set('reward',reward);var that=this;$.post('index.php?route=d_quickcheckout/cart/updateReward',this.toJSON(),function(data){that.updateForm(data);},'json').error();},});qc.CartView=qc.View.extend({initialize:function(e){this.template=e.template;qc.event.bind("update",this.update,this);this.model.on("change",this.render,this);this.render();},events:{'click button.increase':'increaseQuantity','click button.decrease':'decreaseQuantity','click button.delete':'deleteQuantity','change input.qc-product-qantity':'updateQuantity','change input#voucher':'updateVoucher','change input#coupon':'updateCoupon','change input#reward':'updateReward',},template:'',decreaseQuantity:function(e){var quantity=$(e.currentTarget).parent().next();this.model.updateQuantity(quantity.attr('name'),parseInt(quantity.val())-1);if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'click','cart.quantity.decrease');}
preloaderStart();},increaseQuantity:function(e){var quantity=$(e.currentTarget).parent().prev();this.model.updateQuantity(quantity.attr('name'),parseInt(quantity.val())+1);if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'click','cart.quantity.increase');}
preloaderStart();},deleteQuantity:function(e){var quantity=$(e.currentTarget).parent().prev();this.model.updateQuantity(quantity.attr('name'),0);if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'click','cart.quantity.delete');}
preloaderStart();},updateQuantity:function(e){var quantity=$(e.currentTarget);this.model.updateQuantity(quantity.attr('name'),parseInt(quantity.val()));if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update','cart.quantity');}
preloaderStart();},updateHeaderCart:function(total){setTimeout(function(){$('#cart > button').html('<span id="cart-total"><i class="fa fa-shopping-cart"></i> '+total+'</span>');},100);$('#cart > ul').load('index.php?route=common/cart/info ul li');},updateVoucher:function(e){this.model.updateVoucher($(e.currentTarget).val());this.model.set('errors',[]);this.model.set('successes',[]);if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update','cart.voucher');}
preloaderStart();},updateCoupon:function(e){this.model.updateCoupon($(e.currentTarget).val());this.model.set('errors',[]);this.model.set('successes',[]);if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update','cart.coupon');}
preloaderStart();},updateReward:function(e){this.model.updateReward($(e.currentTarget).val());this.model.set('errors',[]);this.model.set('successes',[]);if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'update','cart.reward');}
preloaderStart();},update:function(data){if(data.cart){this.model.set('cart',data.cart);}
if(data.products){this.model.set('products',data.products);}
if(data.vouchers){this.model.set('vouchers',data.vouchers);}
if(data.totals){this.model.set('totals',data.totals);this.updateHeaderCart(data.total);}
if(data.cart_errors){this.model.set('errors',data.cart_errors);}
if(typeof(data.cart_error)!=='undefined'){this.model.set('error',data.cart_error);}
if(data.cart_successes){this.model.set('successes',data.cart_successes);}
if(typeof(data.show_price)!=='undefined'){this.model.set('show_price',data.show_price);}
if(data.account&&data.account!==this.model.get('account')){this.changeAccount(data.account);}
if(data.cart_weight){this.model.set('cart_weight',data.cart_weight);}},render:function(){$(this.el).html(this.template({'model':this.model.toJSON()}));$('.qc-product-qantity').each(function(){$(this).mask($(this).attr('data-mask'),{placeholder:""});})},});qc.Payment=qc.Model.extend({defaults:'',initialize:function(){this.set('config',config.account[this.get('account')].payment);},changeAccount:function(account){this.set('account',account);this.set('config',config.account[this.get('account')].payment);},});qc.PaymentView=qc.View.extend({initialize:function(e){this.template=e.template;qc.event.bind("update",this.update,this);qc.event.bind("paymentConfirm",this.paymentConfirm,this);this.model.on("change",this.render,this);this.render();},template:'',paymentConfirm:function(){$('.alert').remove();if(Number(this.model.get('payment_payment_popup'))){$('#payment_modal').modal('show');}else{var href=$(this.model.get('trigger'),this.$el).attr('href');if(href!=''&&href!=undefined){document.location.href=href;}else{$(this.model.get('trigger'),this.$el).click();}}},update:function(data){if(data.payment){this.model.set('payment',data.payment);}
if(data.payment_payment_title){this.model.set('payment_payment_title',data.payment_payment_title);}
if(typeof(data.payment_payment_popup)!=='undefined'){this.model.set('payment_payment_popup',data.payment_payment_popup);}
if(data.account&&data.account!==this.model.get('account')){this.changeAccount(data.account);}},render:function(){$(this.el).html(this.template({'model':this.model.toJSON()}));},});qc.Confirm=qc.Model.extend({defaults:{'confirm':'','config':'','account':''},initialize:function(){this.set('config',config.account[this.get('account')].confirm);},changeAccount:function(account){this.set('account',account);this.set('config',config.account[this.get('account')].confirm);},updateField:function(name,value){this.set(name,value);var json=this.toJSON();var that=this;$.post('index.php?route=d_quickcheckout/confirm/updateField',{'confirm':json.confirm},function(data){that.updateForm(data);},'json').error();},update:function(){var that=this;$.post('index.php?route=d_quickcheckout/confirm/update',{},function(data){that.updateForm(data);qc.event.trigger('paymentConfirm');that.recreateOrder();},'json').error();},recreateOrder:function(){$.post('index.php?route=d_quickcheckout/confirm/recreateOrder','',function(data){},'json').error();}});qc.ConfirmView=qc.View.extend({initialize:function(e){this.template=e.template;qc.event.bind("update",this.update,this);qc.event.bind("changeAccount",this.changeAccount,this);this.render();},events:{'click button#qc_confirm_order':'confirm',},template:'',confirm:function(){preloaderStart();var valid=true;$("#d_quickcheckout form").each(function(){if(!$(this).valid()){valid=false;preloaderStop();}});if(valid){this.model.update();}
if(parseInt(config.general.analytics_event)){ga('send','event',config.name,'click','confirm.confirm');}},changeAccount:function(account){if(this.model.get('account')!==account){this.model.changeAccount(account);this.render();}},update:function(data){if(data.confirm){this.model.set('confirm',data.confirm);}
if(typeof(data.show_confirm)!=='undefined'){this.model.set('show_confirm',data.show_confirm);this.render();}
if(typeof(data.payment_popup)!=='undefined'){this.model.set('payment_popup',data.payment_popup);this.render();}
if(data.account&&data.account!==this.model.get('account')){this.changeAccount(data.account);}},render:function(){$(this.el).html(this.template({'model':this.model.toJSON()}));this.fields=new qc.FieldView({el:$("#confirm_form"),model:this.model,template:_.template($("#field_template").html())});this.fields.render();},});